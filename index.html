<!Doctype>
<html>
<head>
<title> Earthquakes </title>
<meta charset="UTF-8">
<link href="style.css" rel="stylesheet">

<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDuaInbKvmpKaGVBVm0OtuaADP_CVcejv4&sensor=true"></script>
<script src="jquery-1.7.2.min.js"></script>


<script>

  
  function initial() {
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(41,-87);
    var specs = {
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      zoom: 5,
    } //end specs
    map = new google.maps.Map(document.getElementById("map"), specs);
    document.getElementById('address').value="";
  } //end initial
  
  
 function codeAddress() {
    
    var address = document.getElementById("address").value;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
	var lat=results[0].geometry.location.lat();
	var lng=results[0].geometry.location.lng();
	
	var north=lat+1;
	var south=lat-1;
	var east=lng+1;
	var west=lng-1;           // defining north, south, east and west to plug into the url
	
	var url='http://api.geonames.org/earthquakesJSON?north='+north+'&south='+south+'&east='+east+'&west='+west+'&username=deepakvenkat&callback=?';
	
	map.setCenter(results[0].geometry.location);
	
	$.getJSON(url,function(data){
	    var places=[];	
		for(var i=0; i<data.earthquakes.length; i++){ //goes through earthquake list and places markers on map
			var latlng=new google.maps.LatLng(data.earthquakes[i].lat,data.earthquakes[i].lng); //assigns coordinates for each earthquake
			places[i] = new google.maps.Marker({ //takes each coordinate and places a marker on the map
			map: map, 
			position: latlng, 
			title: 'Earthquake Specs',
			html:'\n Date and Time: '+data.earthquakes[i].datetime+'\n Magnitude: '+data.earthquakes[i].magnitude+'\n Depth: '+data.earthquakes[i].depth
			}); //end google.maps.Marker
			
			google.maps.event.addListener(places[i], "click", function () { //event listener- click marker to get earthquake info
				alert(this.html);
			}); //end listener
			
		} //end for loop
			
	} //end function(data)
	); //end getJSON 
	
	 
      } else {
        alert("Geocode was not successful for the following reason: " + status);
    }//end if else
    });//end geocoder.geocode
  }
  
	
</script>





</head>

<body onload="initial()">
  <header>	
	<h1>Earthquake Locator </h1>
	
	<h4>By: Lauren Aloia <br/>2014</h4>
  </header><br>
  <div>
    Enter City: <input id="address" type="textbox" onkeydown="if(event.keyCode==13) codeAddress()">
    <input id="bfind "type="button" value="Go" onclick="codeAddress()">

  </div>
<div id="map"></div>
</body>

</html>
